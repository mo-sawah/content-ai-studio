(()=>{"use strict";const e=window.React,t=window.wp.element,a=window.wp.components,r=function({setActiveView:t}){return(0,e.createElement)("div",{className:"atm-hub"},(0,e.createElement)("h2",null,"How can I help you today :)"),(0,e.createElement)("p",{className:"atm-hub-subtitle"},"Generate articles, images, podcasts and many more soon"),(0,e.createElement)("div",{className:"atm-hub-actions"},(0,e.createElement)(a.Button,{isPrimary:!0,onClick:()=>t("articles")},"Generate Articles"),(0,e.createElement)(a.Button,{isPrimary:!0,onClick:()=>t("images")},"Generate Images"),(0,e.createElement)(a.Button,{isPrimary:!0,onClick:()=>t("podcast")},"Generate Podcast"),(0,e.createElement)(a.Button,{isPrimary:!0,onClick:()=>t("graphs")},"Generate Graphs"),(0,e.createElement)(a.Button,{isPrimary:!0,disabled:!0},"Generate Videos"),(0,e.createElement)(a.Button,{isSecondary:!0,disabled:!0},"Coming Soon")),(0,e.createElement)("p",{className:"atm-hub-footer"},"Your Day to Day AI helper, Content AI Studio."))},n=window.wp.data,l=(e,t)=>jQuery.ajax({url:atm_studio_data.ajax_url,type:"POST",data:{action:e,nonce:atm_studio_data.nonce,...t}}),o=function(){const[r,o]=(0,t.useState)(!1),[i,s]=(0,t.useState)(""),[c,d]=(0,t.useState)(""),[m,u]=(0,t.useState)(""),[g,p]=(0,t.useState)("default_seo"),[w,h]=(0,t.useState)(""),[b,v]=(0,t.useState)(""),[E,y]=(0,t.useState)(""),[f,S]=(0,t.useState)(!1),{savePost:_}=(0,n.useDispatch)("core/editor"),k=(0,n.useSelect)(e=>e("core/editor").isSavingPost()),C=[{label:"Use Default Model",value:""},...Object.entries(atm_studio_data.article_models).map(([e,t])=>({label:t,value:e}))],A=Object.entries(atm_studio_data.writing_styles).map(([e,{label:t}])=>({label:t,value:e}));return(0,e.createElement)("div",{className:"atm-form-container"},(0,e.createElement)("div",{className:"atm-grid-2"},(0,e.createElement)(a.TextControl,{label:"Keyword",value:c,onChange:d,placeholder:"e.g., AI in digital marketing",disabled:r||k}),(0,e.createElement)(a.TextControl,{label:"or Article Title",value:m,onChange:u,placeholder:"e.g., 5 Ways AI is Revolutionizing Marketing",disabled:r||k})),(0,e.createElement)("div",{className:"atm-grid-3"},(0,e.createElement)(a.SelectControl,{label:"Article Model",value:w,options:C,onChange:h,disabled:r||k}),(0,e.createElement)(a.SelectControl,{label:"Writing Style",value:g,options:A,onChange:p,disabled:r||k}),(0,e.createElement)(a.SelectControl,{label:"Article Length",value:b,options:[{label:"Default",value:""},{label:"Short (~500 words)",value:"500"},{label:"Standard (~800 words)",value:"800"},{label:"Medium (~1200 words)",value:"1200"},{label:"Long (~2000 words)",value:"2000"}],onChange:v,disabled:r||k})),(0,e.createElement)(a.TextareaControl,{label:"Custom Prompt (Optional)",value:E,onChange:y,placeholder:"Leave empty to use the selected Writing Style. If you write a prompt here, it will be used instead.",rows:"6",disabled:r||k}),(0,e.createElement)(a.CheckboxControl,{label:"Also generate a featured image",checked:f,onChange:S,disabled:r||k}),(0,e.createElement)(a.Button,{isPrimary:!0,onClick:async()=>{o(!0);const e=document.getElementById("atm-studio-root").getAttribute("data-post-id");if(!m&&!c)return alert("Please provide a keyword or an article title."),void o(!1);try{let t=m;if(!t&&c){s("Generating compelling title...");const e=await l("generate_article_title",{keyword:c,model:w});if(!e.success)throw new Error(e.data);t=e.data.article_title}s("Writing article content...");const a=await l("generate_article_content",{post_id:e,article_title:t,model:w,writing_style:g,custom_prompt:E,word_count:b});if(!a.success)throw new Error(a.data);if(((e,t)=>{const a=document.body.classList.contains("block-editor-page"),r=window.marked?window.marked.parse(t):t;if(a){wp.data.dispatch("core/editor").editPost({title:e});const t=wp.blocks.parse(r),a=wp.data.select("core/block-editor").getBlocks();if(a.length>0&&(1!==a.length||"core/paragraph"!==a[0].name||""!==a[0].attributes.content)){const e=a.map(e=>e.clientId);wp.data.dispatch("core/block-editor").removeBlocks(e)}wp.data.dispatch("core/block-editor").insertBlocks(t)}else jQuery("#title").val(e),jQuery("#title-prompt-text").hide(),jQuery("#title").trigger("blur"),window.tinymce&&window.tinymce.get("content")?window.tinymce.get("content").setContent(r):jQuery("#content").val(r)})(t,a.data.article_content),s("✅ Article content inserted!"),f){s("Saving post..."),await _(),s("Generating featured image...");const t=await l("generate_featured_image",{post_id:e,prompt:""});if(t.success)return s("✅ All done! Reloading to show new image..."),void setTimeout(()=>window.location.reload(),1500);alert("Article was generated and saved, but the image failed: "+t.data)}o(!1),setTimeout(()=>s(""),3e3)}catch(e){const t=e.message||"An unknown error occurred.";s(`Error: ${t}`),o(!1)}},disabled:r||k||!c&&!m},r||k?(0,e.createElement)(a.Spinner,null):"Generate Creative Article"),i&&(0,e.createElement)("p",{className:"atm-status-message"},i))},i=(e,t)=>jQuery.ajax({url:atm_studio_data.ajax_url,type:"POST",data:{action:e,nonce:atm_studio_data.nonce,...t}}),s=function(){const[r,l]=(0,t.useState)(!1),[o,s]=(0,t.useState)(""),[c,d]=(0,t.useState)(""),[m,u]=(0,t.useState)("newsapi"),[g,p]=(0,t.useState)(!1),[w,h]=(0,t.useState)(!1),{savePost:b}=(0,n.useDispatch)("core/editor"),v=(0,n.useSelect)(e=>e("core/editor").isSavingPost());return(0,e.createElement)("div",{className:"atm-form-container"},(0,e.createElement)(a.TextControl,{label:"News Topic",value:c,onChange:d,placeholder:"e.g., recent AI developments",disabled:r||v}),(0,e.createElement)(a.SelectControl,{label:"News Source",value:m,options:[{label:"NewsAPI.org",value:"newsapi"},{label:"GNews.io",value:"gnews"},{label:"The Guardian",value:"guardian"}],onChange:u,disabled:r||v}),(0,e.createElement)(a.CheckboxControl,{label:"Force fresh search (bypasses cache)",checked:g,onChange:p,disabled:r||v}),(0,e.createElement)(a.CheckboxControl,{label:"Also generate a featured image",checked:w,onChange:h,disabled:r||v}),(0,e.createElement)(a.Button,{isPrimary:!0,onClick:async()=>{if(!c)return void alert("Please enter a topic for the news article.");l(!0),s("Searching for latest news...");const e=document.getElementById("atm-studio-root").getAttribute("data-post-id");try{const t=await i("generate_news_article",{topic:c,news_source:m,force_fresh:g});if(!t.success)throw new Error(t.data);if(s("Writing article..."),((e,t)=>{const a=document.body.classList.contains("block-editor-page"),r=window.marked?window.marked.parse(t):t;if(a){wp.data.dispatch("core/editor").editPost({title:e});const t=wp.blocks.parse(r),a=wp.data.select("core/block-editor").getBlocks();if(a.length>0&&(1!==a.length||"core/paragraph"!==a[0].name||""!==a[0].attributes.content)){const e=a.map(e=>e.clientId);wp.data.dispatch("core/block-editor").removeBlocks(e)}wp.data.dispatch("core/block-editor").insertBlocks(t)}else jQuery("#title").val(e),jQuery("#title-prompt-text").hide(),jQuery("#title").trigger("blur"),window.tinymce&&window.tinymce.get("content")?window.tinymce.get("content").setContent(r):jQuery("#content").val(r)})(t.data.article_title,t.data.article_content),s("✅ News article inserted!"),w){s("Saving post..."),await b(),s("Generating featured image...");const t=await i("generate_featured_image",{post_id:e,prompt:""});if(t.success)return s("✅ All done! Reloading to show image..."),void setTimeout(()=>window.location.reload(),1500);alert("Article was generated and saved, but the image failed: "+t.data)}l(!1),setTimeout(()=>s(""),3e3)}catch(e){s(`Error: ${e.message}`),l(!1)}},disabled:r||v||!c},r||v?(0,e.createElement)(a.Spinner,null):"Generate News Article"),o&&(0,e.createElement)("p",{className:"atm-status-message"},o))},c=(e,t)=>jQuery.ajax({url:atm_studio_data.ajax_url,type:"POST",data:{action:e,nonce:atm_studio_data.nonce,...t}}),d=function(){const[r,n]=(0,t.useState)(!1),[l,o]=(0,t.useState)(""),[i,s]=(0,t.useState)(""),[d,m]=(0,t.useState)(!1),[u,g]=(0,t.useState)(!0),[p,w]=(0,t.useState)([]),h=async(e="",t=!1)=>{n(!0),o(e?"Searching feeds...":"Fetching latest..."),w([]);const a=document.getElementById("atm-studio-root").getAttribute("data-post-id");try{const r=await c("fetch_rss_articles",{post_id:a,keyword:e,use_scraping:t});if(!r.success)throw new Error(r.data);w(r.data),o(r.data.length>0?`Found ${r.data.length} articles.`:"No articles found.")}catch(e){o(`Error: ${e.message}`)}finally{n(!1)}};return(0,e.createElement)("div",{className:"atm-form-container"},(0,e.createElement)(a.TextControl,{label:"Search by Keyword (Optional)",value:i,onChange:s,placeholder:"e.g., Trump, AI, Healthcare",disabled:r}),(0,e.createElement)(a.CheckboxControl,{label:"Deep Content Search",help:"Scrapes full article content for more accurate keyword matching (slower but more precise).",checked:d,onChange:m,disabled:r}),(0,e.createElement)(a.CheckboxControl,{label:"Use Full Article Content for Generation",help:"Scrapes the complete article for better AI rewriting (recommended).",checked:u,onChange:g,disabled:r}),(0,e.createElement)("div",{className:"atm-grid-2"},(0,e.createElement)(a.Button,{isSecondary:!0,onClick:()=>h(i,d),disabled:r||!i},r?(0,e.createElement)(a.Spinner,null):"Search Feeds"),(0,e.createElement)(a.Button,{isPrimary:!0,onClick:()=>h(),disabled:r},r?(0,e.createElement)(a.Spinner,null):"Fetch Latest Articles")),l&&(0,e.createElement)("p",{className:"atm-status-message"},l),p.length>0&&(0,e.createElement)("div",{className:"atm-rss-results-list"},p.map((t,l)=>(0,e.createElement)("div",{key:t.guid,className:"atm-rss-item"},(0,e.createElement)("strong",{className:"atm-rss-item-title"},t.title),(0,e.createElement)("small",{className:"atm-rss-item-meta"},t.source," | ",t.date),(0,e.createElement)("p",{className:"atm-rss-item-desc"},t.description.substring(0,120),"..."),(0,e.createElement)(a.Button,{isPrimary:!0,onClick:()=>(async(e,t)=>{o(`Generating from "${e.title}"...`),n(!0);const a=[...p];a[t].isGenerating=!0,w(a);const r=document.getElementById("atm-studio-root").getAttribute("data-post-id");try{const a=await c("generate_article_from_rss",{post_id:r,article_url:e.link,article_guid:e.guid,rss_content:e.content,use_full_content:u});if(!a.success)throw new Error(a.data);((e,t)=>{const a=document.body.classList.contains("block-editor-page"),r=window.marked?window.marked.parse(t):t;if(a){wp.data.dispatch("core/editor").editPost({title:e});const t=wp.blocks.parse(r),a=wp.data.select("core/block-editor").getBlocks();if(a.length>0&&(1!==a.length||"core/paragraph"!==a[0].name||""!==a[0].attributes.content)){const e=a.map(e=>e.clientId);wp.data.dispatch("core/block-editor").removeBlocks(e)}wp.data.dispatch("core/block-editor").insertBlocks(t)}else jQuery("#title").val(e),jQuery("#title-prompt-text").hide(),jQuery("#title").trigger("blur"),window.tinymce&&window.tinymce.get("content")?window.tinymce.get("content").setContent(r):jQuery("#content").val(r)})(a.data.article_title,a.data.article_content),o(`✅ Article generated from "${e.title}"!`),w(p.filter((e,a)=>a!==t))}catch(e){o(`Error: ${e.message}`)}finally{n(!1);const e=[...p];e[t].isGenerating=!1,w(e)}})(t,l),disabled:r||t.isGenerating},t.isGenerating?(0,e.createElement)(a.Spinner,null):"Generate Article")))))},m=function({setActiveView:r}){const[n,l]=(0,t.useState)("creative");return(0,e.createElement)("div",{className:"atm-generator-view"},(0,e.createElement)("div",{className:"atm-view-header"},(0,e.createElement)("button",{className:"atm-back-btn",onClick:()=>r("hub")},(0,e.createElement)("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},(0,e.createElement)("path",{d:"M15 18L9 12L15 6",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"}))),(0,e.createElement)("h3",null,"Generate Article")),(0,e.createElement)("div",{className:"atm-form-container"},(0,e.createElement)(a.SelectControl,{label:"Article Type",value:n,options:[{label:"Creative Article",value:"creative"},{label:"Latest News Article",value:"news"},{label:"Article from RSS Feed",value:"rss_feed"}],onChange:e=>l(e)}),(0,e.createElement)("hr",{className:"atm-form-divider"}),(()=>{switch(n){case"news":return(0,e.createElement)(s,null);case"rss_feed":return(0,e.createElement)(d,null);default:return(0,e.createElement)(o,null)}})()))},u=function({setActiveView:r}){const[l,o]=(0,t.useState)(!1),[i,s]=(0,t.useState)(""),[c,d]=(0,t.useState)(""),[m,u]=(0,t.useState)(""),[g,p]=(0,t.useState)(""),[w,h]=(0,t.useState)(""),{editPost:b}=(0,n.useDispatch)("core/editor"),{image_provider:v}=atm_studio_data,E=w||v;return(0,e.createElement)("div",{className:"atm-generator-view"},(0,e.createElement)("div",{className:"atm-view-header"},(0,e.createElement)("button",{className:"atm-back-btn",onClick:()=>r("hub"),disabled:l},(0,e.createElement)("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},(0,e.createElement)("path",{d:"M15 18L9 12L15 6",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"}))),(0,e.createElement)("h3",null,"Generate Featured Image")),(0,e.createElement)("div",{className:"atm-form-container"},(0,e.createElement)(a.SelectControl,{label:"Image Provider",value:w,onChange:h,options:[{label:`Use Default (${v})`,value:""},{label:"OpenAI (DALL-E 3)",value:"openai"},{label:"Google (Imagen 4)",value:"google"}],disabled:l}),(0,e.createElement)(a.TextareaControl,{label:"Image Prompt",help:"A descriptive prompt is required for image generation.",value:c,onChange:d,placeholder:"A cinematic, photorealistic image of...",rows:"5",disabled:l}),(0,e.createElement)("div",{className:"atm-grid-2"},(0,e.createElement)(a.SelectControl,{label:"Image Size (Override)",value:m,onChange:u,options:[{label:"Use Default",value:""},{label:"16:9 Landscape",value:"1792x1024"},{label:"1:1 Square",value:"1024x1024"},{label:"9:16 Portrait",value:"1024x1792"}],disabled:l}),(0,e.createElement)(a.SelectControl,{label:"Quality (Override)",value:g,onChange:p,options:[{label:"Use Default",value:""},{label:"Standard",value:"standard"},{label:"HD",value:"hd"}],disabled:l,help:"openai"!==E?"Note: Quality setting is only for OpenAI/DALL-E 3.":""})),(0,e.createElement)(a.Button,{isPrimary:!0,onClick:async()=>{if(!c.trim())return void alert("Please enter a prompt for the image.");o(!0),s("Enhancing prompt & generating image...");const e=document.getElementById("atm-studio-root").getAttribute("data-post-id");try{const a=await(t={post_id:e,prompt:c,size:m,quality:g,provider:E},jQuery.ajax({url:atm_studio_data.ajax_url,type:"POST",data:{action:"generate_featured_image",nonce:atm_studio_data.nonce,...t}}));if(!a.success)throw new Error(a.data);{s("✅ Image generated and set!");const{attachment_id:e,html:t}=a.data;document.body.classList.contains("block-editor-page")?b({featured_media:e}):jQuery("#postimagediv .inside").html(t)}}catch(e){const t=e.message||"An unknown error occurred.";s(`Error: ${t}`)}finally{o(!1),setTimeout(()=>s(""),5e3)}var t},disabled:l},l?(0,e.createElement)(a.Spinner,null):"Generate & Set Featured Image"),i&&(0,e.createElement)("p",{className:"atm-status-message"},i)))},g=(e,t)=>jQuery.ajax({url:atm_studio_data.ajax_url,type:"POST",data:{action:e,nonce:atm_studio_data.nonce,...t}}),p=function({setActiveView:r}){const[l,o]=(0,t.useState)(!1),[i,s]=(0,t.useState)(""),[c,d]=(0,t.useState)(""),[m,u]=(0,t.useState)("alloy"),[p,w]=(0,t.useState)("English"),h=(0,n.useSelect)(e=>e("core/editor").getCurrentPostId(),[]),b=Object.entries(atm_studio_data.tts_voices).map(([e,t])=>({label:t,value:e}));return(0,e.createElement)("div",{className:"atm-generator-view"},(0,e.createElement)("div",{className:"atm-view-header"},(0,e.createElement)("button",{className:"atm-back-btn",onClick:()=>r("hub"),disabled:l},(0,e.createElement)("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},(0,e.createElement)("path",{d:"M15 18L9 12L15 6",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"}))),(0,e.createElement)("h3",null,"Generate Podcast")),(0,e.createElement)("div",{className:"atm-form-container"},(0,e.createElement)(a.SelectControl,{label:"Script Language",value:p,onChange:w,options:[{label:"English",value:"English"},{label:"Spanish",value:"Spanish"},{label:"French",value:"French"},{label:"German",value:"German"}],disabled:l}),(0,e.createElement)(a.Button,{isSecondary:!0,onClick:async()=>{const e=wp.data.select("core/editor").getEditedPostContent();if(e.trim()){o(!0),s("Generating podcast script...");try{const t=await g("generate_podcast_script",{content:e,post_id:h,language:p});if(!t.success)throw new Error(t.data);d(t.data.script),s("✅ Script generated successfully. You can now edit it below.")}catch(e){s(`Error generating script: ${e.message}`)}finally{o(!1)}}else alert("Please write some content in the editor before generating a script.")},disabled:l},l&&i.includes("script")?(0,e.createElement)(a.Spinner,null):"1. Generate Script from Post Content"),(0,e.createElement)(a.TextareaControl,{label:"Podcast Script",help:"The generated script will appear here. You can edit it before generating the audio.",value:c,onChange:d,rows:"15",disabled:l}),(0,e.createElement)(a.SelectControl,{label:"AI Voice",value:m,onChange:u,options:b,disabled:l}),(0,e.createElement)(a.Button,{isPrimary:!0,onClick:async()=>{if(c.trim()){o(!0),s("Generating MP3 audio... this may take a minute.");try{const e=await g("generate_podcast",{post_id:h,script:c,voice:m});if(!e.success)throw new Error(e.data);s("✅ Success! The page will now reload to show the audio player."),setTimeout(()=>window.location.reload(),2e3)}catch(e){s(`Error generating audio: ${e.message}`),o(!1)}}else alert("Please generate or write a script in the text area before creating the audio.")},disabled:l||!c.trim()},l&&i.includes("audio")?(0,e.createElement)(a.Spinner,null):"2. Generate MP3 Audio"),i&&(0,e.createElement)("p",{className:"atm-status-message"},i)))},w=function(){const[a,n]=(0,t.useState)(sessionStorage.getItem("atm-active-view")||"hub");return(0,t.useEffect)(()=>{sessionStorage.setItem("atm-active-view",a)},[a]),(0,e.createElement)("div",{className:"atm-studio-container"},(()=>{switch(a){case"articles":return(0,e.createElement)(m,{setActiveView:n});case"images":return(0,e.createElement)(u,{setActiveView:n});case"podcast":return(0,e.createElement)(p,{setActiveView:n});default:return(0,e.createElement)(r,{setActiveView:n})}})())};document.addEventListener("DOMContentLoaded",()=>{const a=document.getElementById("atm-studio-root");a&&(0,t.render)((0,e.createElement)(w,null),a)})})();